<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pipeline Dashboard</title>
  <style>
    body{font-family:Inter,system-ui,Arial;background:#0b1220;color:#e8eefc;margin:0}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:#131d33;border:1px solid #2a3a61;border-radius:12px;padding:14px;margin:10px 0}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .k{font-size:12px;color:#9fb1d9}.v{font-size:22px;font-weight:700}
    .winner{background:linear-gradient(120deg,#1b3358,#1f3f43)}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .green{background:#123a2f;color:#7ef0c8}.amber{background:#3c3114;color:#ffd782}.red{background:#4a1f23;color:#ff9ca8}
    a{color:#9fd0ff}
    .bars{display:flex;align-items:flex-end;gap:8px;height:150px;padding:8px;background:#0f1729;border:1px solid #2a3a61;border-radius:10px}
    .bar{width:34px;background:linear-gradient(180deg,#60a5fa,#34d399);border-radius:6px 6px 0 0;position:relative}
    .bar span{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);font-size:10px;color:#bcd0f4;white-space:nowrap}
    .winner-list{font-size:13px;color:#c7d8f7;line-height:1.5}
    @media(max-width:900px){.grid{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <h1>üìä Dutch Idea Pipeline Dashboard</h1>
  <div id="run" class="k">Laden‚Ä¶</div>

  <div class="card winner" id="winner">Winner laden‚Ä¶</div>

  <div class="grid">
    <div class="card"><div class="k">Status</div><div id="status">-</div></div>
    <div class="card"><div class="k">Idee√´n</div><div class="v" id="ideas">-</div></div>
    <div class="card"><div class="k">Winner score</div><div class="v" id="score">-</div></div>
    <div class="card"><div class="k">Aanbevolen</div><div class="v" id="rec">-</div></div>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Trendkaart (laatste runs)</h3>
    <div class="bars" id="trendBars"><div class="k">Laden‚Ä¶</div></div>
    <div class="winner-list" id="winnerTrend" style="margin-top:10px">Laden‚Ä¶</div>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Artifacts</h3>
    <ul>
      <li><a href="01-forum-scout.md">01-forum-scout.md</a></li>
      <li><a href="02-business-analysis.md">02-business-analysis.md</a></li>
      <li><a href="03-final-winner-summary.md">03-final-winner-summary.md</a></li>
      <li><a href="04-log-scan.txt">04-log-scan.txt</a></li>
      <li><a href="00-run-metadata.txt">00-run-metadata.txt</a></li>
      <li><a href="dashboard-data.json">dashboard-data.json</a></li>
      <li><a href="run-state.json">run-state.json</a></li>
      <li><a href="history-manifest.json">history-manifest.json</a></li>
    </ul>
  </div>
</div>
<script>
const $=id=>document.getElementById(id);
async function getJson(p){const r=await fetch(p,{cache:'no-store'}); if(!r.ok) return null; return r.json();}
function statusPill(s){
  const c=s==='green'?'green':(s==='amber'?'amber':'red');
  return `<span class="pill ${c}">${(s||'unknown').toUpperCase()}</span>`;
}
(async()=>{
  const data = await getJson('dashboard-data.json');
  const state = await getJson('run-state.json');
  if(!data){ $('winner').textContent='Geen dashboard-data.json gevonden'; return; }

  $('run').textContent='Laatste run: '+(data.runTimestamp||'-');
  $('winner').innerHTML=`üèÜ <b>${data.winner||'Onbekend'}</b><br><span class="k">Score: ${data.winnerScore||'-'}</span>`;
  $('status').innerHTML=statusPill((state&&state.status)||data.status||'amber');
  $('ideas').textContent=data.ideasCount ?? '-';
  $('score').textContent=data.winnerScore || '-';
  $('rec').textContent=data.recommendedCount ?? '-';

  const trend=data.trend||[];
  if(!trend.length){ $('trendBars').innerHTML='<div class="k">Nog geen trenddata</div>'; $('winnerTrend').textContent='-'; return; }

  const points=trend.map(t=>{
    const m=(t.score||'0/35').match(/(\d+)\/(\d+)/)||[];
    const num=m[1]?parseInt(m[1],10):0, den=m[2]?parseInt(m[2],10):35;
    const pct=den?Math.round((num/den)*100):0;
    return {t:t.timestamp,w:t.winner,num,den,pct};
  });
  $('trendBars').innerHTML=points.map(p=>`<div class="bar" style="height:${Math.max(8,p.pct)}px"><span>${p.num}/${p.den}<br>${(p.t||'').slice(5)}</span></div>`).join('');
  $('winnerTrend').innerHTML=points.map(p=>`‚Ä¢ ${p.t}: <b>${p.w}</b>`).join('<br>');
})();
</script>
</body>
</html>