<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dutch Idea Pipeline ‚Äî Business Dashboard</title>
  <style>
    :root{--bg:#0b1020;--card:#121a33;--muted:#93a4c3;--text:#eaf0ff;--accent:#6ee7b7;--accent2:#60a5fa;--border:rgba(255,255,255,.12)}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#0a0f1d,#0e1630);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .top{display:flex;justify-content:space-between;gap:16px;align-items:center;flex-wrap:wrap}
    h1{margin:0;font-size:1.4rem}.sub{color:var(--muted);font-size:.95rem}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:16px}
    .card{background:rgba(18,26,51,.9);border:1px solid var(--border);border-radius:14px;padding:14px}
    .winner{grid-column:span 12;background:linear-gradient(120deg,rgba(110,231,183,.12),rgba(96,165,250,.12));}
    .winner b{font-size:1.1rem}
    .kpi{grid-column:span 3}.kpi .v{font-size:1.2rem;font-weight:700}
    .col6{grid-column:span 6}.col4{grid-column:span 4}.col8{grid-column:span 8}.col12{grid-column:span 12}
    h2{margin:0 0 8px 0;font-size:1rem}
    ul{margin:8px 0 0 18px;padding:0} li{margin:5px 0}
    a{color:#9bd0ff}
    .bmc{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .bmc .box{min-height:125px;background:#0f1730;border:1px solid var(--border);border-radius:10px;padding:10px}
    .label{font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:.82rem;white-space:pre-wrap;max-height:220px;overflow:auto;color:#d8e3ff}
    .foot{margin-top:16px;color:var(--muted);font-size:.86rem}
    .idea-nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
    select,button{background:#0f1730;color:#eaf0ff;border:1px solid var(--border);border-radius:8px;padding:7px 10px}
    button{cursor:pointer}
    @media (max-width:900px){.kpi,.col4,.col6,.col8{grid-column:span 12}.bmc{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>üìä Dutch Idea Pipeline Dashboard</h1>
        <div class="sub" id="runTs">Laden‚Ä¶</div>
      </div>
      <div class="sub">Business model canvas stijl ‚Ä¢ Laatste run snapshot</div>
    </div>

    <div class="grid">
      <div class="card winner" id="winner">üèÜ Winner laden‚Ä¶</div>

      <div class="card kpi"><div class="label">Idee√´n</div><div class="v" id="kpiIdeas">-</div></div>
      <div class="card kpi"><div class="label">Top score</div><div class="v" id="kpiScore">-</div></div>
      <div class="card kpi"><div class="label">Aanbevolen</div><div class="v" id="kpiRecommended">-</div></div>
      <div class="card kpi"><div class="label">Status</div><div class="v" style="color:var(--accent)">Actief</div></div>

      <div class="card col6">
        <h2>Top 3 kansen</h2>
        <ul id="top3"><li>Laden‚Ä¶</li></ul>
      </div>

      <div class="card col6">
        <h2>Quick wins</h2>
        <ul id="quickWins"><li>Laden‚Ä¶</li></ul>
      </div>

      <div class="card col12">
        <h2>Business Model Canvas (selecteer idee)</h2>
        <div class="idea-nav">
          <button id="prevIdea">‚Üê Vorige</button>
          <select id="ideaSelect"></select>
          <button id="nextIdea">Volgende ‚Üí</button>
          <span class="sub" id="ideaMeta"></span>
        </div>
        <div class="bmc">
          <div class="box"><div class="label">Customer Segments</div><div id="bmc1">-</div></div>
          <div class="box"><div class="label">Value Proposition</div><div id="bmc2">-</div></div>
          <div class="box"><div class="label">Channels</div><div id="bmc3">-</div></div>
          <div class="box"><div class="label">Revenue Streams</div><div id="bmc4">-</div></div>
          <div class="box"><div class="label">Key Metrics</div><div id="bmc5">-</div></div>
        </div>
      </div>

      <div class="card col8">
        <h2>Bestanden</h2>
        <ul>
          <li><a href="01-forum-scout.md">01-forum-scout.md</a></li>
          <li><a href="02-business-analysis.md">02-business-analysis.md</a></li>
          <li><a href="03-final-winner-summary.md">03-final-winner-summary.md</a></li>
          <li><a href="04-log-scan.txt">04-log-scan.txt</a></li>
          <li><a href="pipeline-debug.log">pipeline-debug.log</a></li>
        </ul>
      </div>

      <div class="card col4">
        <h2>Log-scan (latest)</h2>
        <div class="mono" id="logPreview">Laden‚Ä¶</div>
      </div>
    </div>

    <div class="foot">Tip: hard refresh met Ctrl/Cmd+Shift+R als je nieuwe run niet direct ziet.</div>
  </div>

<script>
let IDEAS=[];
let CURRENT=0;
const $=id=>document.getElementById(id);
async function getText(path){const r=await fetch(path,{cache:'no-store'}); if(!r.ok) throw new Error(path+' not found'); return await r.text();}
function pick(re,txt,def='-'){const m=txt.match(re); return m?m[1].trim():def;}
function listAfter(header, txt, n=3){const i=txt.indexOf(header); if(i<0) return []; const c=txt.slice(i,i+1800); return [...c.matchAll(/^\d+\.\s+(.+)$/gm)].slice(0,n).map(m=>m[1]);}
function bulletsAfter(header, txt, n=3){const i=txt.indexOf(header); if(i<0) return []; const c=txt.slice(i,i+1200); return [...c.matchAll(/^-\s+(.+)$/gm)].slice(0,n).map(m=>m[1]);}

function parseIdeas(md){
  const re=/## Idee\s+\d+:\s+(.+)\n([\s\S]*?)(?=\n---\n\n## Idee\s+\d+:|\n---\n\n# Final Ranking|$)/g;
  const out=[]; let m;
  while((m=re.exec(md))){
    const title=m[1].trim(); const body=m[2];
    out.push({
      title,
      score: pick(/\*\*Totaalscore\*\*: ([^\n]+)/, body, '-'),
      segment: pick(/\*\*Target segment\*\*: ([^\n]+)/, body, 'Consumenten/KBM met dit probleem'),
      value: pick(/\*\*Original Context\*\*: ([^\n]+)/, body, 'Lost een terugkerend probleem op.'),
      channels: pick(/### Next Steps[\s\S]*?1\.\s*([^\n]+)/, body, 'SEO + communities + partnerships'),
      revenue: pick(/\*\*Revenue model\*\*: ([^\n]+)/, body, 'Freemium + premium'),
      metrics: 'Conversie, time-to-resolution, retention, cost-to-serve'
    });
  }
  return out;
}

function renderIdea(i){
  if(!IDEAS.length) return;
  CURRENT=(i+IDEAS.length)%IDEAS.length;
  const x=IDEAS[CURRENT];
  $('ideaSelect').value=String(CURRENT);
  $('ideaMeta').textContent=`Score: ${x.score}`;
  $('bmc1').textContent=x.segment;
  $('bmc2').textContent=x.value;
  $('bmc3').textContent=x.channels;
  $('bmc4').textContent=x.revenue;
  $('bmc5').textContent=x.metrics;
}

(async()=>{
  try{
    const [finalSum,business,scout,log]=await Promise.all([
      getText('03-final-winner-summary.md'),
      getText('02-business-analysis.md'),
      getText('01-forum-scout.md').catch(()=>''),
      getText('04-log-scan.txt').catch(()=>''),
    ]);

    const run=pick(/Run:\s*([^\n]+)/,finalSum,new Date().toISOString());
    const winnerLine=pick(/\n1\.\s*([^\n]+)/,finalSum,'Nog geen winnaar');
    const winnerName=winnerLine.split(' - ')[0];
    const winnerScore=(winnerLine.match(/(\d+\/\d+)/)||[])[1]||'-';

    $('runTs').textContent='Laatste run: '+run;
    $('winner').innerHTML='üèÜ <b>'+winnerName+'</b><div class="sub">Topkandidaat van deze run ‚Ä¢ Score: '+winnerScore+'</div>';

    $('kpiIdeas').textContent=pick(/Aantal idee√´n geanalyseerd:\s*(\d+)/,business,'-');
    $('kpiScore').textContent=winnerScore;
    $('kpiRecommended').textContent=pick(/Aanbevolen voor verdere exploratie:\s*(\d+)/,business,'-');

    const top3=listAfter('**Top 3 Opportunities:**',business,3);
    const quick=bulletsAfter('**Quick Wins**',business,3);
    $('top3').innerHTML=(top3.length?top3:['Geen data']).map(x=>'<li>'+x+'</li>').join('');
    $('quickWins').innerHTML=(quick.length?quick:['Geen data']).map(x=>'<li>'+x+'</li>').join('');

    const scoutIdeas=[...scout.matchAll(/^##\s+Idee\s+\d+/gm)].length;
    if(scoutIdeas) $('kpiIdeas').textContent=scoutIdeas;

    $('logPreview').textContent=(log||'Geen log-scan beschikbaar').slice(0,1400);

    IDEAS=parseIdeas(business);
    const sel=$('ideaSelect');
    sel.innerHTML=IDEAS.map((x,idx)=>`<option value="${idx}">${idx+1}. ${x.title}</option>`).join('');
    let start=Math.max(0, IDEAS.findIndex(x=>x.title.toLowerCase().includes(winnerName.toLowerCase())));
    renderIdea(start);

    sel.addEventListener('change',e=>renderIdea(parseInt(e.target.value,10)||0));
    $('prevIdea').addEventListener('click',()=>renderIdea(CURRENT-1));
    $('nextIdea').addEventListener('click',()=>renderIdea(CURRENT+1));

  } catch(e){
    $('winner').textContent='Kon dashboarddata niet laden: '+e.message;
  }
})();
</script>
</body>
</html>