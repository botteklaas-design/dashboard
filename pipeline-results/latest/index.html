<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pipeline Dashboard</title>
  <style>
    body{font-family:Inter,system-ui,Arial;background:#0b1220;color:#e8eefc;margin:0}
    .wrap{max-width:1150px;margin:0 auto;padding:20px}
    .card{background:#131d33;border:1px solid #2a3a61;border-radius:12px;padding:14px;margin:10px 0}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .k{font-size:12px;color:#9fb1d9}.v{font-size:22px;font-weight:700}
    .winner{background:linear-gradient(120deg,#1b3358,#1f3f43)}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .green{background:#123a2f;color:#7ef0c8}.amber{background:#3c3114;color:#ffd782}.red{background:#4a1f23;color:#ff9ca8}
    a{color:#9fd0ff}
    select{background:#0f1729;color:#e8eefc;border:1px solid #2a3a61;border-radius:8px;padding:8px;min-width:280px}
    .bars{display:flex;align-items:flex-end;gap:8px;height:150px;padding:8px;background:#0f1729;border:1px solid #2a3a61;border-radius:10px}
    .bar{width:34px;background:linear-gradient(180deg,#60a5fa,#34d399);border-radius:6px 6px 0 0;position:relative}
    .bar span{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);font-size:10px;color:#bcd0f4;white-space:nowrap}
    .winner-list{font-size:13px;color:#c7d8f7;line-height:1.5}
    .bmc{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .box{background:#0f1729;border:1px solid #2a3a61;border-radius:10px;padding:10px;min-height:95px}
    .lbl{font-size:11px;color:#9fb1d9;text-transform:uppercase}
    @media(max-width:900px){.grid,.bmc{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <h1>üìä Dutch Idea Pipeline Dashboard</h1>
  <div id="run" class="k">Laden‚Ä¶</div>

  <div class="card winner" id="winner">Winner laden‚Ä¶</div>

  <div class="grid">
    <div class="card"><div class="k">Status</div><div id="status">-</div></div>
    <div class="card"><div class="k">Idee√´n</div><div class="v" id="ideas">-</div></div>
    <div class="card"><div class="k">Winner score</div><div class="v" id="score">-</div></div>
    <div class="card"><div class="k">Aanbevolen</div><div class="v" id="rec">-</div></div>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Trendkaart (laatste runs)</h3>
    <div class="bars" id="trendBars"><div class="k">Laden‚Ä¶</div></div>
    <div class="winner-list" id="winnerTrend" style="margin-top:10px">Laden‚Ä¶</div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <h3 style="margin:0">Business Model Canvas per idee</h3>
      <select id="ideaSelect"></select>
    </div>
    <div class="k" id="ideaMeta" style="margin-top:8px">Laden‚Ä¶</div>
    <div class="bmc" style="margin-top:10px">
      <div class="box"><div class="lbl">Probleem</div><div id="bmcProblem">-</div></div>
      <div class="box"><div class="lbl">Doelgroep (ICP)</div><div id="bmcIcp">-</div></div>
      <div class="box"><div class="lbl">Waardepropositie</div><div id="bmcValue">-</div></div>
      <div class="box"><div class="lbl">Revenue</div><div id="bmcRevenue">-</div></div>
      <div class="box"><div class="lbl">MVP Scope</div><div id="bmcMvp">-</div></div>
      <div class="box"><div class="lbl">Belangrijkste Risico</div><div id="bmcRisk">-</div></div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0">Artifacts</h3>
    <ul>
      <li><a href="01-forum-scout.md">01-forum-scout.md</a></li>
      <li><a href="02-business-analysis.md">02-business-analysis.md</a></li>
      <li><a href="03-final-winner-summary.md">03-final-winner-summary.md</a></li>
      <li><a href="04-log-scan.txt">04-log-scan.txt</a></li>
      <li><a href="00-run-metadata.txt">00-run-metadata.txt</a></li>
      <li><a href="dashboard-data.json">dashboard-data.json</a></li>
      <li><a href="run-state.json">run-state.json</a></li>
      <li><a href="history-manifest.json">history-manifest.json</a></li>
    </ul>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
async function getJson(p){ const r=await fetch(p,{cache:'no-store'}); if(!r.ok) return null; return r.json(); }
async function getText(p){ const r=await fetch(p,{cache:'no-store'}); if(!r.ok) return ''; return r.text(); }
function statusPill(s){
  const c=s==='green'?'green':(s==='amber'?'amber':'red');
  return `<span class="pill ${c}">${(s||'unknown').toUpperCase()}</span>`;
}
function m(re,s,d='-'){ const x=s.match(re); return x?x[1].trim():d; }
function parseIdeas(md){
  // Split each idea block by the next idea header or final ranking
  const re=/## Idee\s+\d+:\s+(.+)\n([\s\S]*?)(?=\n## Idee\s+\d+:|\n# Final Ranking|$)/g;
  const arr=[]; let x;
  while((x=re.exec(md))){
    const body=x[2];
    arr.push({
      title:x[1],
      total:m(/\*\*Totaalscore\*\*:?\s*([^\n]+)/,body,'-'),
      rep:m(/\*\*Repetition Score\*\*:?\s*([^\n]+)/,body,'-'),
      conf:m(/\*\*Confidence\*\*:?\s*([^\n]+)/,body,'-'),
      problem:m(/\*\*Original Context\*\*: ([^\n]+)/,body,'-'),
      icp:m(/\*\*Target segment\*\*: ([^\n]+)/,body,'Consumenten/KBM'),
      revenue:m(/\*\*Revenue model\*\*: ([^\n]+)/,body,'Freemium + premium'),
      mvp:m(/\*\*MVP scope\*\*: ([^\n]+)/,body,'MVP <= 6 weken'),
      risk:m(/‚ö†Ô∏è \*\*Risk 1\*\*: ([^\n]+)/,body,'Uitvoering/GTM')
    });
  }
  return arr;
}

(async()=>{
  const [data,state,biz] = await Promise.all([
    getJson('dashboard-data.json'),
    getJson('run-state.json'),
    getText('02-business-analysis.md')
  ]);
  if(!data){ $('winner').textContent='Geen dashboard-data.json gevonden'; return; }

  $('run').textContent='Laatste run: '+(data.runTimestamp||'-');
  $('winner').innerHTML=`üèÜ <b>${data.winner||'Onbekend'}</b><br><span class="k">Score: ${data.winnerScore||'-'}</span>`;
  $('status').innerHTML=statusPill((state&&state.status)||data.status||'amber');
  $('ideas').textContent=data.ideasCount ?? '-';
  $('score').textContent=data.winnerScore || '-';
  $('rec').textContent=data.recommendedCount ?? '-';

  const trend=data.trend||[];
  if(!trend.length){
    $('trendBars').innerHTML='<div class="k">Nog geen trenddata</div>';
    $('winnerTrend').textContent='-';
  } else {
    const points=trend.map(t=>{
      const ms=(t.score||'0/35').match(/(\d+)\/(\d+)/)||[];
      const num=ms[1]?parseInt(ms[1],10):0, den=ms[2]?parseInt(ms[2],10):35;
      const pct=den?Math.round((num/den)*100):0;
      return {t:t.timestamp,w:t.winner,num,den,pct};
    });
    $('trendBars').innerHTML=points.map(p=>`<div class="bar" style="height:${Math.max(8,p.pct)}px"><span>${p.num}/${p.den}<br>${(p.t||'').slice(5)}</span></div>`).join('');
    $('winnerTrend').innerHTML=points.map(p=>`‚Ä¢ ${p.t}: <b>${p.w}</b>`).join('<br>');
  }

  const ideas=parseIdeas(biz);
  const sel=$('ideaSelect');
  if(!ideas.length){
    sel.innerHTML='<option>Geen idee-data gevonden</option>';
    $('ideaMeta').textContent='Tip: check 02-business-analysis.md format.';
    return;
  }
  sel.innerHTML=ideas.map((i,idx)=>`<option value="${idx}">${idx+1}. ${i.title}</option>`).join('');

  function renderIdea(idx){
    const it=ideas[idx] || ideas[0];
    $('ideaMeta').textContent=`Score: ${it.total} ‚Ä¢ Repetition: ${it.rep} ‚Ä¢ Confidence: ${it.conf}`;
    $('bmcProblem').textContent=it.problem;
    $('bmcIcp').textContent=it.icp;
    $('bmcValue').textContent=`${it.title} ‚Äî concrete probleemoplossing`;
    $('bmcRevenue').textContent=it.revenue;
    $('bmcMvp').textContent=it.mvp;
    $('bmcRisk').textContent=it.risk;
  }

  renderIdea(0);
  sel.addEventListener('change',e=>renderIdea(parseInt(e.target.value,10)||0));
})();
</script>
</body>
</html>